---
 - hosts: all
   pre_tasks:
     - name: Gather facts from ALL hosts (regardless of limit or tags)
       setup:
       delegate_to: "{{ item }}"
       delegate_facts: True
       when: hostvars[item]['ansible_default_ipv4'] is not defined
       with_items: "{{ groups['all'] }}"
   roles:
     # core services
     - hosts
     - firewall
     - accounts
     - apt_packages
     - miniforge
     - nfs
     - mysql
     - minio
     - backups
     - traefik
     - openldap
     - keycloak
     # workflows
     - slurm
     # monitoring
     - prometheus
     - grafana
     # data-science services
     - conda_store
     - jupyterhub
     - dask_gateway
     - ipyparallel
     # plugins
     - bodo
